---
title: "Working with Primary data"
subtitle: "`cori.data.fcc`:: an example of data as code"
author: "Olivier Leroy"
date: "October 20 2024"
institute: "Center On Rural Innovation"
fontsize: 20pt
favicon: assets/images/Logo-Mark_Black.png
format:
  revealjs: 
    theme: src/custom_cori.scss
    logo: img/CORI_Logo.png
    css: assets/fonts.css
    footnotes-hover:: true
from: markdown+emoji
editor: visual
---


## PLAN

* Presentation (Me & CORI)

* FCC's Data

 
## :wave: Hi, I am Olivier 

- Socials: [LinkedIn](https://www.linkedin.com/in/olivier-leroy-r/) | [Mastodon](https://fosstodon.org/@defuneste) | [Personal Website](https://branchtwigleaf.com/about.html) 

![Source: [Harvard Business Review](https://hbr.org/2012/10/data-scientist-the-sexiest-job-of-the-21st-century)](img/hbrsexiestjob.png){width=800} 

- Not Data Scientist but Data Engineer and Working with primary data: "messy, unstructured data" is on us now    

## Slides are online: 

Realized in [Quarto](https://quarto.org/) (Reavealjs) hosted in [GitHub](https://github.com/ruralinnovation/conf_URISA_2023)

![](img/qr.svg){height="300" fig-align="center"}

[https://ruralinnovation.github.io/prez_auber_2024/#/title-slide](https://ruralinnovation.github.io/conf_URISA_2023/#/title-slide)

## Center On Rural Innovation ([CORI](https://ruralinnovation.us/))

*Advancing economic prosperity in rural America through the creation of inclusive tech economy ecosystem that support scalable entrepreneurship and tech job creation*

![](img/cori_triangle.png){fig-align="center"}

1. Broadband Infrastucture is an important part of it

2. Rural data: Need to go back to primary data  

# FCC's Data

## Federal Communications Commission ([FCC](https://www.fcc.gov/)) 

- Agency in charge of regulating "everything" communications

- Lot of useful datasets!

- Their data landscape is evolving fast (now they have a [platform](https://opendata.fcc.gov/)!)


|                      | [Form 477](https://www.fcc.gov/economics-analytics/industry-analysis-division/form-477-resources)             | [National Broadband Map](https://broadbandmap.fcc.gov/home)                                                                                                                                                                                                                              |
|-------------------------|------------------------|------------------------|
| US Census Boundaries | 2010             | 2020                                                                                                                                                                                                                                 |
| Type of recording    | self declarative | self declarative                                                                                                                                                                                                                     |
| Granularity          | Census blocks     | [Locations](https://broadbandmap.fcc.gov/location-summary/fixed?version=dec2022&location_id=1350199199&addr1=390+MORGAN+ST&addr2=OBERLIN%2C+OH+44074&zoom=15.00&vlon=-82.231744&vlat=41.287448&br=r&speed=25_3&tech=1_2_3_4_5_6_7_8) |
| Services             | Mobile/**Fixed** | Mobile/**Fixed**  |
|Timeframe | 2014-2021 | 2022 - *Ongoing* |
| Releases | twice a year | twice a year[^verion] |
| Size | 400MB/year | 22GB/year |

[^verion]: One release can have multiple version

## FCC data is included in our apps and analysis work

We released multiple apps relying on FCC primary data: 

- 2023: [Broadband Climate Risk Mitigation Tool](https://broadband-risk.ruralinnovation.us/)

- 2024: [Rural Broadband Mapping Tool](https://rural-broadband-map.ruralinnovation.us/)

(also included in ERC tools should I mention it?)

Importance of using PG, see next slide 

data as files data as tables and the limit 

(out of sync tables/files)

## Our Previous data processing pattern:

```{mermaid}
%%{init: {'theme': 'base', 'themeVariables': { 'fontSize': '20px', 'fontFamily': 'Bitter'}}}%%
flowchart LR
    A1[FCC Website] --> B1[Server]
    A2[TIGER Census block] --> C2
    subgraph Ingestion
    direction TB
    B1--> B2[Data Wrangling]
    B2--> B3[Populate source DB]
    end
    subgraph Transform
    direction TB
    C1[Remove Sat.]--> C2[Count Services]
    C2 --> C3[Blocks DB]
    end
    subgraph Serving
    direction TB
    D1[Prod. Server] --> D2[Analytic Tables]
    end
    Ingestion --> Transform
    C3 --> D1
    D1--> E1[Tools]
    D2--> E1
    D2 --> E4[Data team <BR> Broadband team]
    style Ingestion fill:#fff
    style Transform fill:#fff
    style Serving fill:#fff
```


- Classic ELT (Extract Load Tranform): the tranform step is done in DB and here slow (or $$)  

- Change in business/research needs: "we need ISP" / "We should exlude location with bad latency" ->  redo ingestion/load/transform

> You can quote me.... "My manager regularly asks for quick turn deliveries".... "He's bullies the team with short delivery times"




## Manual v.s. ...

:::: {.columns}

::: {.column width="50%"}

![](img/manual_fcc.mov)


:::

::: {.column width="50%"}

* :repeat: Repeat for every state  
* :repeat: Repeat for every version  
* :red_circle: Error prone 

:::

::::


## ... Code Automated ...

:::: {.columns}

::: {.column width="50%"}

::: {.panel-tabset}

### Visual

![](img/dl_nbm_smaller.mov)

### Code

```{r}
#| label: example_dl_nbm
#| eval: false
#| echo: true
library(cori.data.fcc)

dir <- "data_swamp/nbm/"

get_nbm_release()

nbm_data <- get_nbm_available()

system(sprintf("mkdir -p %s", dir))

dl_nbm(
  path_to_dl = "data_swamp/nbm",
  release_date = "June 30, 2023",
  data_type = "Fixed Broadband",
  data_category = "Nationwide",
)

```

:::

:::

::: {.column width="50%"}

```{r}
#| label: check_dl_2
#| eval: false
#| echo: true
num_files <- get_nbm_available() |>
  dplyr::filter(release == "June 30, 2023" &
                data_type == "Fixed Broadband" &
                data_category == "Nationwide") |>
  nrow()

files_dl <- length(list.files(dir,
                              pattern = "*.zip"))

identical(num_files, files_dl)
# TRUE
```

:::

::::

## ... Code Packaged

# cori.data.fcc

## New technologies

- DuckDB and S3

  - takewaysa of those technology

- Parquet and interoperability 

skip PG here. 

## Packaging data as code

1. Benefits from the language ecosystem: 
  
    - What does this function do? `?get_nbm_block`

    - How can I integrate this functions in my workflow? Vignettes

    - A doubt on how the data was processed: Articles and data-raw

    - Easy to distribute (GitHub / built-in functions)

    - Tests! TODO codecov 

    - Versions / updates with a [Changelog](https://ruralinnovation.github.io/cori.data.fcc/news/index.html) 

>  internally developed packages are [...] extra expert team members.[^dataanalysisreuse]

2. Data as code: 

    - Better documentation: `get_fcc_dictionary`

    - Website to share it

    - Capitalize on it! 
        * New project that is requiring FCC staff estimes: it can be added 

[^dataanalysisreuse]: https://milesmcbain.xyz/posts/data-analysis-reuse/

## why public

- Open source is :

* a way to publish: ie you can read the code 

* a way to share: ie you can use it

We care more about process than product or to say it differently the product is just a mean to reach a goal (a process). We want to lower the cost of using that data so rural america can check what their isp are saying and challenge it and plan to get a better bb.


# Examples of uses cases

## How to get it: 

The source code is hosted on [GitHub](https://github.com/ruralinnovation/cori.data.fcc) it has a website: [https://ruralinnovation.github.io/cori.data.fcc/index.html](https://ruralinnovation.github.io/cori.data.fcc/index.html) 

You need the R packages [{remotes}](https://remotes.r-lib.org/) (or [pak](https://pak.r-lib.org/))

```{r}
#| eval: false
#| label: install-package
#| echo: true
 
install.packages("remotes")
remotes::install_github("ruralinnovation/cori.data.fcc")
```

:construction: Check the version you have and see what new versions are offering :construction:
```{r}
#| label: version-package
#| echo: true
packageVersion("cori.data.fcc")
```

## Pot. ideas

- Block covered BEAD like

- ISP networks

- Just download data

## Download files

- see above / could be that automated code is enough 


## Use CORI curated files

## Pot. discussions

place of business logic in data example bead category 

## Summary

- data as code:

  * Metadata is hard: moving data as code help on that

  * enhance reproducibility  

  * easier to capitalize/build on it 



## References

TODO:

McBain (2024, March 11). Before I Sleep: Patterns and anti-patterns of data analysis reuse. Retrieved from https://milesmcbain.com/posts/data-analysis-reuse/

https://www.emilyriederer.com/post/team-of-packages/#collaboration


R packages 2ed

## Contacts

Website: [https://ruralinnovation.us](https://ruralinnovation.us)


[LinkedIn](https://www.linkedin.com/company/11099658) | [Twitter](https://twitter.com/Ruralinno) | [Facebook](https://www.facebook.com/RuralInno/) | [Instagram](https://www.instagram.com/ruralinno/) | [YouTube](https://www.youtube.com/channel/UCyqbtSrv4Nad9vVv4dQptcA) 
